<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>admins</title>
    <link rel="stylesheet" href="{% static 'mascota/css/bootstrap.min.css' %}" >
    <script src="{% static 'mascota/js/bootstrap.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'mascota/css/style.css' %}"> 
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark ">
        <div class="container-fluid">
          <a class="navbar-brand" href="">MI MASCOTA FELIZ</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar" aria-labelledby="offcanvasDarkNavbarLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">MENU PRINCIPAL</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link "  href="{% url 'index' %}">HOME</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="{% url 'registro_admin' %}">REGISTRASE COMO VENDEDOR</a>
                </li>
              </ul> 
            </div>
          </div>
        </div>
        <header class="container-fluid bg-primary d-flex justify-content-center" id="titu">
            <p class="text-light mb-0 p-2 fs-6">REGISTRO VENDEDOR</p>
          </header>
      </nav>
      <div class="container form-container">
        <div class="form-box">
            <img src="{% static 'mascota/img/admin.jpg' %}" width="80px" height="80px">
            <div class="form-content">
                <h2 class="text-center mb-4">Formulario de Registro Vendedor</h2>
                <form action="{% url 'registro_admin' %}" method="POST" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="gmail" class="form-label">Gmail</label>
                        <input type="email" class="form-control" id="gmail" name="gmail" required>
                        <div class="invalid-feedback">
                            Por favor ingresa un Gmail válido con la estructura nombre@mascota.cl.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" pattern="[A-Za-zÁáÉéÍíÓóÚúÑñ\s]{3,}" required>
                        <div class="invalid-feedback">
                            Por favor ingresa tu nombre (solo letras, al menos 3 caracteres).
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="apellido" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="apellido" name="apellido" pattern="[A-Za-zÁáÉéÍíÓóÚúÑñ\s]{3,}" required>
                        <div class="invalid-feedback">
                            Por favor ingresa tu apellido (solo letras, al menos 3 caracteres).
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="direccion" class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="direccion" name="direccion" minlength="6" required>
                        <div class="invalid-feedback">
                            Por favor ingresa tu dirección.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" name="password" required minlength="6">
                        <div class="invalid-feedback">
                            La contraseña debe tener al menos 6 caracteres.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="palabra" class="form-label">Palabra clave de la empresa</label>
                        <input type="password" class="form-control" id="palabra" name="palabra" required>
                        <div class="invalid-feedback">
                            Por favor ingresa la palabra clave correcta.
                        </div>
                    </div>
                    <button name="opcion" class="btn btn-primary" type="submit" value="agregar">Registrarse</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal para mostrar mensajes -->
    <div class="modal fade" id="registroModal" tabindex="-1" aria-labelledby="registroModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registroModalLabel">Registro Admin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if modal_success %}
                        <div class="alert alert-success">{{ modal_success }}</div>
                    {% endif %}
                    {% if modal_error %}
                        <div class="alert alert-danger">{{ modal_error }}</div>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    

</body>
<script>
(function () {
    'use strict';
    window.addEventListener('load', function () {
        var forms = document.getElementsByClassName('needs-validation');
        Array.prototype.filter.call(forms, function (form) {
            form.addEventListener('submit', function (event) {
                var gmail = document.getElementById('gmail');
                var palabra = document.getElementById('palabra');
                var gmailPattern = /^[a-zA-Z0-9._%+-]+@mascota\.cl$/;
                var valid = true;

                // Validación del correo electrónico
                if (!gmailPattern.test(gmail.value)) {
                    gmail.setCustomValidity('Correo electrónico debe tener la estructura nombre@mascota.cl.');
                    valid = false;
                } else {
                    gmail.setCustomValidity('');
                }

                // Validación de la palabra clave
                if (palabra.value !== 'feliz') {
                    palabra.setCustomValidity('Palabra clave incorrecta.');
                    valid = false;
                } else {
                    palabra.setCustomValidity('');
                }

                // Validación del formulario
                if (form.checkValidity() === false || !valid) {
                    event.preventDefault();
                    event.stopPropagation();
                } else {
                    event.preventDefault(); // Evita el envío del formulario para manejarlo con AJAX

                    // Enviar formulario usando AJAX
                    $.ajax({
                        type: "POST",
                        url: form.action,
                        data: $(form).serialize(),
                        success: function (response) {
                            // Mostrar el modal con el mensaje correspondiente
                            if (response.modal_success) {
                                $('#registroModal .modal-body').html('<div class="alert alert-success">' + response.modal_success + '</div>');
                            } else if (response.modal_error) {
                                $('#registroModal .modal-body').html('<div class="alert alert-danger">' + response.modal_error + '</div>');
                            }
                            $('#registroModal').modal('show'); // Mostrar el modal
                        }
                    });
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>

</html>